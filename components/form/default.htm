{% spaceless %}
{% set form = __SELF__.form.attributes %}
<form id="butils-forms-{{ form.id }}" method="POST" data-request="onSend" class="needs-validation">
    <input hidden name="form_id" type="text" value="{{ form.id }}">
    {% for field in __SELF__.form.fields %}
    <div class="form-group">
        {% if field.label %}<label for="{{ field.name }}">{{ field.label }}</label>{% endif %}

        {% if field.tag == 'input' %}
        <input name="{{ field.name }}" {% if field.type %}type="{{ field.type }}" {% endif %} {% if field.pattern
            %}pattern="{{ field.pattern }}" {% endif %} {% if field.placeholder %}placeholder="{{field.placeholder }}"
            {% endif %} {% if field.required %}required{% endif %}
            class="{% if field.type is same as 'checkbox' %}checkbox{% else %}form-control{% endif %}">

        {% elseif field.tag == 'textarea' %}
        <textarea name="{{ field.name }}" {% if field.placeholder %}placeholder="{{ field.placeholder }}" {% endif %} {%
            if field.required %}required{% endif %} rows="6" class="form-control"></textarea>

        {% elseif field.tag == 'select' %}
        <select name="{{ field.name }}" {% if field.placeholder %}placeholder="{{ field.placeholder }}" {% endif %} {%
            if field.required %}required{% endif %} rows="6" class="form-control">
            {% for option in field.options %}
            <option value="{{ option.value }}">{{ option.label }}</option>
            {% endfor %}
        </select>
        {% endif %}

        <div class="error-message {{ field.name }}"></div>
    </div>
    {% endfor %}
    <div class="form-group">
        <button class="btn btn-primary" type="submit" data-attach-loading>Send</button>
    </div>
    <div id="butils-forms-{{ form.id }}-alert"></div>
</form>
{% endspaceless %}
{% put scripts %}
{% spaceless %}
<script>
    function setInvalidField(fieldValidator, defaultVal = true) {
        const input = fieldValidator.parentElement.querySelector('input')
            ? fieldValidator.parentElement.querySelector('input')
            : (fieldValidator.parentElement.querySelector('textarea')
                ? fieldValidator.parentElement.querySelector('textarea')
                : null)
            ;

        if (defaultVal) {
            input.classList.add('is-invalid');
        } else {
            input.classList.remove('is-invalid');
        }
    }
</script>
{% endspaceless %}
{% endput %}